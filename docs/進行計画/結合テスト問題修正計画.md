# 結合テスト問題修正計画

## 発見された問題

### 問題1: ルートパス (/) で404エラー

**現象**:

- http://localhost:3001/ にアクセスすると404エラーが表示される

**原因**:

- `src/app/page.tsx` が存在しない、または適切に実装されていない

**期待される動作**:

- 未認証の場合: `/signin` にリダイレクト
- 認証済みの場合: `/todos` にリダイレクト

**修正方針**:

- `src/app/page.tsx` を作成し、認証状態に応じたリダイレクト処理を実装

---

### ~~問題2: サインイン時にデータベース接続エラー~~ ✅ 解決済み

**現象**:

```
AccessDenied: PrismaClientInitializationError
Can't reach database server at `localhost:3306`
```

**原因**:

- MySQLデータベースサーバーが起動していなかった

**対応**:

- データベースを起動することで解決

---

### 問題3: クリッカブルな要素にカーソルポインターが表示されない

**現象**:

- ボタンやリンクなどのクリッカブルな要素にホバーしても、カーソルが `pointer` にならない

**原因**:

- ボタンコンポーネントに `cursor-pointer` クラスが適用されていない可能性

**期待される動作**:

- ボタン、リンク、その他のクリッカブルな要素にホバーすると `cursor: pointer` になる

**修正方針**:

- `src/components/ui/button.tsx` の各バリアントに `cursor-pointer` を追加
- インタラクティブな要素すべてに適切なカーソルスタイルを適用

---

### 問題4: TODO日付表示が yyyy/mm/dd 形式になっていない

**現象**:

- TODO一覧や詳細画面で、日付が期待される `yyyy/mm/dd` 形式で表示されていない

**原因**:

- 日付フォーマット関数が実装されていない、または正しく適用されていない

**期待される動作**:

- すべての日付が `2025/10/16` のような `yyyy/mm/dd` 形式で表示される

**修正方針**:

- 日付フォーマット用のユーティリティ関数を作成または修正
- TODO表示コンポーネントで日付フォーマット関数を適用

---

## 修正タスク

### タスク1: ルートページの実装 ✅ 完了

**ファイル**: `src/app/page.tsx`

**実装内容**:

```typescript
import { redirect } from "next/navigation";
import { auth } from "@/auth";

export default async function RootPage() {
  const session = await auth();

  // 認証済みの場合はTODO一覧へ
  if (session?.user) {
    redirect("/todos");
  }

  // 未認証の場合はサインインページへ
  redirect("/signin");
}
```

**確認項目**:

- [x] ファイル作成 ✅
- [ ] 認証済みユーザーが `/` にアクセス → `/todos` にリダイレクト
- [ ] 未認証ユーザーが `/` にアクセス → `/signin` にリダイレクト

---

### タスク2: カーソルポインターの修正

**ファイル**: `src/components/ui/button.tsx`

**実装内容**:

- 各バリアントのクラス名に `cursor-pointer` を追加
- `disabled` 状態では `cursor-not-allowed` を適用

**確認項目**:

- [ ] ボタンコンポーネントに `cursor-pointer` を追加
- [ ] リンクやその他のクリッカブル要素を確認
- [ ] ホバー時にカーソルが変わることを確認

---

### タスク3: 日付フォーマットの修正

**ファイル**:

- `src/lib/utils/format.ts` (新規作成または既存の修正)
- TODO表示コンポーネント（`src/app/todos/page.tsx` 等）

**実装内容**:

```typescript
// src/lib/utils/format.ts
export function formatDate(date: Date | string): string {
  const d = typeof date === "string" ? new Date(date) : date;
  const year = d.getFullYear();
  const month = String(d.getMonth() + 1).padStart(2, "0");
  const day = String(d.getDate()).padStart(2, "0");
  return `${year}/${month}/${day}`;
}
```

**確認項目**:

- [ ] 日付フォーマット関数の実装
- [ ] TODO一覧での日付表示確認
- [ ] TODO詳細での日付表示確認
- [ ] 作成日時、更新日時、期限日すべてが正しい形式で表示されることを確認

---

## 修正後のテスト計画

### 修正完了後の確認項目

1. **ルートパスのリダイレクト**
   - [ ] 未認証で `/` → `/signin` にリダイレクト
   - [ ] 認証済みで `/` → `/todos` にリダイレクト

2. **サインイン機能**
   - [ ] GitHub認証が成功する
   - [ ] データベースにユーザーが保存される
   - [ ] `/todos` にリダイレクトされる

3. **TODO機能**
   - [ ] TODO一覧が表示される
   - [ ] TODO作成が成功する
   - [ ] TODO編集が成功する
   - [ ] TODO削除が成功する

---

## 実装順序

1. **即座に対応（必須）**
   - [x] データベースサーバーの起動確認・起動 ✅
   - [x] `src/app/page.tsx` の実装 ✅

2. **UI/UX改善（優先度：高）**
   - [ ] カーソルポインターの修正（タスク2）
   - [ ] 日付フォーマットの修正（タスク3）

3. **その後**
   - [ ] 結合テストの再実施
   - [ ] 手順書への結果記録

---

## 次のアクション

1. ~~タスク1を実施（`src/app/page.tsx` の作成）~~ ✅ 完了
2. タスク2を実施（カーソルポインターの修正）
3. タスク3を実施（日付フォーマットの修正）
4. 開発サーバー再起動（必要に応じて）
5. 結合テスト再実施
