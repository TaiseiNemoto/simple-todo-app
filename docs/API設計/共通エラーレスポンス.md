## ボディ

| フィールド | 型     | 必須 | 説明                                                                                |
| ---------- | ------ | ---- | ----------------------------------------------------------------------------------- |
| `code`     | string | 必須 | 機械可読な短い識別子（英大文字＋下線推奨）。例: `INVALID_PARAMETER`, `UNAUTHORIZED` |
| `message`  | string | 必須 | 人間向けの短い説明（日本語）                                                        |
| `details`  | object | 任意 | エラーの詳細情報（バリデーションエラーの場合はZodのエラー配列など）                 |

## ステータスと代表コード

| HTTP | 代表`code`                                             | 使い所（例）                 |
| ---- | ------------------------------------------------------ | ---------------------------- |
| 400  | `INVALID_PARAMETER` / `INVALID_BODY` / `INVALID_INPUT` | 型・値・形式不正、相関不整合 |
| 401  | `UNAUTHORIZED`                                         | 未認証                       |
| 403  | `FORBIDDEN`                                            | 自分の資源ではない           |
| 404  | `NOT_FOUND`                                            | 存在しない                   |
| 500  | `INTERNAL_ERROR`                                       | サーバ内部エラー             |

## 実装済みエラーコード

実装で使用しているエラーコードは以下の通り：

- `UNAUTHORIZED`: 認証エラー（未認証）
- `FORBIDDEN`: 認可エラー（権限なし、所有者不一致）
- `NOT_FOUND`: リソースが見つからない
- `INVALID_INPUT`: バリデーションエラー（入力値不正）
- `INVALID_PARAMETER`: バリデーションエラー（不正なクエリパラメータ）
- `INVALID_BODY`: バリデーションエラー（不正なリクエストボディ）
- `INTERNAL_ERROR`: 内部サーバーエラー

## レスポンス例

### 401 未認証

```json
{
  "code": "UNAUTHORIZED",
  "message": "認証が必要です"
}
```

### 403 所有者不一致

```json
{
  "code": "FORBIDDEN",
  "message": "このTODOにアクセスする権限がありません"
}
```

### 404 リソース不存在

```json
{
  "code": "NOT_FOUND",
  "message": "TODOが見つかりません"
}
```

### 400 バリデーションエラー（クエリパラメータ）

```json
{
  "code": "INVALID_PARAMETER",
  "message": "無効なクエリパラメータです",
  "details": [
    {
      "path": ["status"],
      "message": "Invalid enum value. Expected 'open' | 'done', received 'invalid'"
    }
  ]
}
```

### 400 バリデーションエラー（リクエストボディ）

```json
{
  "code": "INVALID_BODY",
  "message": "無効なリクエストボディです",
  "details": [
    {
      "path": ["title"],
      "message": "タイトルは必須です"
    }
  ]
}
```

### 500 内部サーバーエラー

```json
{
  "code": "INTERNAL_ERROR",
  "message": "内部サーバーエラーが発生しました"
}
```

## 認証方式

本APIはAuth.js（NextAuth.js）を使用したCookieベースのセッション認証を採用しています。

- **認証Cookie名**: `authjs.session-token`（または`__Secure-authjs.session-token`）
- **認証方法**: ブラウザから自動的に送信されるCookie
- **APIクライアントからの使用**: Cookieヘッダーにセッショントークンを含める

### ブラウザからの使用

ブラウザから`fetch()`などでAPIを呼び出す場合、`credentials: 'include'`を指定してCookieを送信します：

```javascript
fetch("/api/todos", {
  credentials: "include",
});
```

### cURLでの使用例

```bash
curl -X GET http://localhost:3000/api/todos \
  -H "Cookie: authjs.session-token=<your-session-token>"
```
